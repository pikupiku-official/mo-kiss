# dialogue/ - 対話システム

ビジュアルノベルのメイン機能を担当する包括的なシステム

## 主要ファイル

### **controller2.py** - 対話制御
- pygame イベント処理（マウス、キーボード）
- 選択肢判定とテキスト進行制御
- 自動進行・スキップモードの管理

### **model.py** - システム統合
- 各種マネージャーの機能統合（ファサードパターン）
- バージョン管理とモジュール情報提供

### **text_renderer.py** - テキスト描画
- **26文字自動改行システム**
- **3行スクロール表示**
- まばたきアニメーション連携
- 変数置換システム（プレイヤー名など）
- 句読点での遅延制御

### **character_manager.py** - キャラクター管理
- キャラクター移動アニメーション
- 顔パーツ描画（目、口、眉、頬の合成）
- **自動まばたきシステム**（2-5秒間隔）
- 画像スケーリングキャッシュ

### **background_manager.py** - 背景管理
- 背景表示、移動、ズームアニメーション
- 仮想解像度システム対応
- 背景スケーリングキャッシュ

### **choice_renderer.py** - 選択肢システム
- 選択肢表示とマウスハイライト
- 変数置換対応選択肢テキスト
- クリック判定処理

### **scenario_manager.py** - シナリオ制御
- 対話進行のメイン処理
- 各種コマンド処理（キャラクター操作、背景制御、音声制御）
- フェード効果制御

### **data_normalizer.py** - データ正規化
- dialogue_loader の辞書データを統一形式に変換
- キャラクター名変換（桃子→T04_00_00など）

### **dialogue_loader.py** - .ks ファイル解析
- ビジュアルノベル用スクリプト（.ks）の解析
- ストーリーフラグ管理
- 非同期ファイル読み込み

### **notification_manager.py** - 通知システム
- イベント解禁時の通知表示
- システムメッセージの管理
- ユーザーへのフィードバック制御

### **date_manager.py** - 日付表示管理
- ゲーム内日付の表示制御
- 時間情報の表示フォーマット

### **fade_manager.py** - フェード効果管理
- 画面フェードイン・アウト効果
- シーン切り替え時の視覚効果

### **backlog_manager.py** - バックログ機能
- 会話履歴の管理
- 過去の会話内容の表示

### **scroll_manager.py** - スクロール制御
- テキストスクロール効果
- 表示速度の制御

### **text_renderer_patch.py** - テキスト描画パッチ
- テキスト描画の拡張機能
- 特殊効果の追加実装

### **game_manager.py** - ゲーム管理
- ゲーム全体の状態管理
- システム統合制御

### **name_manager.py** - 名前管理
- プレイヤー名の管理
- キャラクター名の変換

## 対応タグ

```
[bg], [bg_show], [bg_move]     # 背景制御
[chara_show], [chara_move], [chara_hide]  # キャラクター制御
[BGM], [BGMSTOP], [BGMSTART]   # BGM制御
[SE]                           # SE制御
[choice]                       # 選択肢
[fadeout], [fadein]           # フェード効果
[scroll-stop]                 # スクロール停止
[event_unlock]                # イベント解禁
[time_advance]                # 時間進行
「」                          # 対話テキスト
```

## 主要機能

- **26文字自動改行** - テキストの自動整形
- **3行スクロール表示** - 読みやすい表示形式
- **自動まばたきシステム** - 自然なキャラクター表現
- **顔パーツ合成** - 表情の動的生成
- **フェード効果** - 滑らかなシーン遷移
- **選択肢分岐** - プレイヤーの選択による物語の分岐
- **変数置換システム** - プレイヤー名などの動的挿入
