# システム設計（To‑Be）

本書は **各モジュール（TITLE / MAIN_MENU / HOME / DIALOGUE / MAP / OPTION）** の役割と責務を整理する。  
遷移は非線形であることを前提とし、細部は `TBD` として残す。

---

## TITLE
### 役割
- 起動画面
- 初期化の入口

### 遷移
- **固定**: TITLE → MAIN_MENU

### セーブ/設定
- セーブなし
- OPTIONなし（開けない）

---

## MAIN_MENU
### 役割
- ゲーム開始/再開の入口

### 想定機能
- はじめから（プレイヤー名入力）
- つづきから（ロード）
- 設定
- ギャラリー（予定）

### 遷移
- MAIN_MENU → HOME（新規開始）
- MAIN_MENU → 保存時の状態（続きから）

### セーブ/設定
- セーブ不要
- OPTIONは開けない（メニュー内設定で対応）

---

## HOME
### 役割
- 自宅シーン（時間や行動の起点）

### 典型フロー
- 朝起きて **DIALOGUE（登校イベント）** or **MAP**
- 帰宅後は HOME で区切る

### 遷移
- HOME → DIALOGUE（イベント発火）
- HOME → MAP（外出）

### セーブ/設定
- セーブ可能
- OPTION可能

---

## DIALOGUE
### 役割
- 物語進行
- イベント単位の実行

### 入口
- MAP から選択したイベント
- HOME から発火するイベント
- その他の条件イベント

### 退出
- DIALOGUE → MAP（昼のループ）
- DIALOGUE → HOME（帰宅など）

### 状態更新
- **シナリオフラグは主にここで更新**
- **時間はイベント終了時に進む**（基本方針）

### セーブ/設定
- セーブ：`TBD`（中断復帰を許すか検討）
- OPTION可能

---

## MAP
### 役割
- イベント選択と移動
- 昼パートの中心

### 遷移
- MAP → DIALOGUE（イベント開始）
- MAP → HOME（帰宅）

### 特記事項
- **イベントが無い場合の時間スキップ**を予定

### セーブ/設定
- セーブ可能
- OPTION可能

---

## OPTION（Overlay）
### 役割
- いつでも開けるポーズ画面
- 設定・セーブ/ロード・メインメニュー戻り

### 振る舞い
- **ポーズ扱い**
- **BGM継続**
- **即時反映**

### 想定項目（現時点）
- 音量
- キーコンフィグ
- 表示
- テキスト速度
- スキップ
- メインメニューに戻る
- セーブ/ロード
- その他 `TBD`

### 開ける状態
- HOME / DIALOGUE / MAP

---

## バックエンド責務（案）
- セーブデータ: `save_manager.py`
- 時間状態: `time_manager.py`
- シナリオフラグ: `events/story_flags.json` + 完了一覧
- プレイヤー名: `data/current_state/player_name.json`
- 設定保存: `TBD`

---

## 未決事項（TBD）
- DIALOGUE中のセーブ/復帰仕様
- OPTIONの追加項目
- 設定保存の形式と保存場所
- MAPの時間スキップ仕様（条件/演出/UI）
