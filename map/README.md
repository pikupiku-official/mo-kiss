# map/ - マップシステム

ゲーム内のマップ画面と移動システムを管理するサブシステム

## 主要ファイル

### **map.py** - メインマップクラス
マップの全体制御を担当

**主要機能：**
- マップの描画と表示
- プレイヤーの移動制御
- イベント発生判定
- 時間帯に応じたマップの変化

### **map_characters.py** - マップ上のキャラクター管理
マップ上に表示されるキャラクターの管理

**主要機能：**
- キャラクターの配置
- キャラクターの移動
- キャラクターとの相互作用
- 時間帯によるキャラクターの出現制御

### **map_config.py** - マップ設定
マップの設定と定数管理

**主要機能：**
- マップレイアウト設定
- 移動可能エリアの定義
- イベント発生条件の設定

### **map_events.py** - マップイベント処理
マップ上で発生するイベントの処理

**主要機能：**
- イベントトリガーの判定
- イベント発生時の処理
- イベント完了状態の管理
- 対話システムへの遷移制御

### **map copy.py** - マップのバックアップ
開発中のバックアップファイル

## 特徴

- **時間帯システム連携：** 朝・昼・放課後・夜によるマップの変化
- **イベント発生判定：** 条件に応じたイベントの自動検出
- **キャラクター配置：** 時間帯とストーリー進行に応じた動的配置
- **直感的な移動：** クリックによる移動システム
- **BGM自動切り替え：** 時間帯・マップタイプ・特定日付に応じた自動BGM切り替え

## BGMシステム

### BGM設定ファイル: map_config.py

**MAP_BGM_CONFIG** - マップタイプ・時間帯別のBGM設定
```python
MAP_BGM_CONFIG = {
    'weekday': {
        '朝': 'subete_no_hajimari.mp3',
        '昼': 'subete_no_hajimari.mp3',
        '放課後': 'subete_no_hajimari.mp3',
    },
    'weekend': {
        '朝': 'subete_no_hajimari.mp3',
        '昼': 'subete_no_hajimari.mp3',
        '放課後': 'subete_no_hajimari.mp3',
    },
    'default': 'subete_no_hajimari.mp3'
}
```

**SPECIAL_DATE_BGM** - 特定日付のBGM設定（優先度高）
```python
SPECIAL_DATE_BGM = {
    # 例: (6, 1): 'special_event.mp3',
    # 例: (6, 15): 'midterm_exam.mp3',
}
```

### BGM切り替えロジック

1. **優先度1:** 特定日付のBGM (SPECIAL_DATE_BGM)
2. **優先度2:** マップタイプ・時間帯別のBGM (MAP_BGM_CONFIG)
3. **優先度3:** デフォルトBGM

### 使用方法

**BGMの追加:**
1. `sounds/bgms/` にBGMファイルを配置
2. `map_config.py` の設定を更新
3. マップ表示時に自動的に再生される

**時間帯やマップタイプの変更時:**
- 自動的に新しいBGMに切り替わる
- 同じBGMが設定されている場合は継続再生
